---
title: "Homework 1"
author: "Abishev Daur"
output:
  html_document:
    df_print: paged
navigation: frame
fontenc: T2A
lang: russian
babel-lang: russian
header-includes: \usepackage[russian]{babel}
toc-depth: 2

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(ggm)
library(vcd)
library(rcompanion)
library(DescTools)
library(psych)

```

## Задание 1

Будем использовать дата фрейм Bwt.csv.
Исследования здоровья и развития детей, проведенных в Окленде, Калифорния, больнице Фонда Кайзера. 

```{r}
df  <- read.csv("Bwt.csv")
df <- df[-c(1)]
df$smoke<-factor(df$smoke,c(0,1),labels=c('Non-smoker','Smoker'))
df$parity<-factor(df$parity,c(0,1),labels=c('Other','Firstborn'))
```

Дата фрейм состоит из 1174 наблюдений и 7 переменных. Переменные:

 **bwt**: вес ребенка в унциях при рождении
 
 **gestation**: срок беременности в 
 
 **parity**: показатель паритета (первенец = 1, иначе = 0)
 
 **age**: возраст матери в годах
 
 **height**: рост матери в дюймах
 
 **weight**: вес матери в фунтах (во время беременности)
 
 **smoke** : индикатор того, курит ли мать (1 = да, 0 = нет)


## Задание 2

В дата фрейме нет пустых значений:
```{r}
sum(is.na(df))
```
Посмотрим краткое описание дата фрейма:
```{r}
str(df)
summary(df)
names(df)
```
**Рассмотрим несколько графиков:**

```{r}
hist(df$bwt, xlab='Вес при рождении', main = 'Гистограмма веса ребенка')

```

```{r}
plot(df$bwt, df$gestation,xlab='Вес при рождении ',ylab='Срок беременности')
```

```{r}
ggplot(df, aes(x= height))+
  geom_density(fill = 'blue', alpha = 0.5) +
  xlab('Рост матери')
```



## Задание 3


Выделим две группы матерей: курящих и не курящих:

```{r}
smok <- subset(df, smoke == 'Smoker')
nosmok <- subset(df, smoke == 'Non-smoker')
```

Проверим гипотезу о равенстве среднего роста для этих двух групп (курящих, не курящих):

```{r}
t.test(smok$height, nosmok$height, alternarive = "two.sided")

```
Статистический вывод: на 5%-ном уровне значимости на наших данных нет оснований отвергнуть нулевую гипотезу в пользу альтернативной (p−value > aplha). 
Содержательный вывод: средний рост курящих и не курящих матерей равны.



Построим теперь 95% доверительные интервалы для среднего и дисперсии по одной из количественных переменных. Возьмем количественную переменную *age* возраст матери.

```{r}
t.test(df$age, conf.level = 0.95)
```
95% доверительный интервал для среднего (26.895, 27.561).


```{r}
n <- length(df$age) - 1
varage <- var(df$age)
lower <-  varage * n / qchisq(0.05/2, n, lower.tail = FALSE)
upper <-  varage * n / qchisq(1 - 0.05/2, n, lower.tail = FALSE)
c(lower = lower, variance = varage, upper = upper)
```
95% доверительный интервал для дисперсии (31.266, 36.762).



## Задание 4


Выберем только количественные переменные из нашего дата фрейма:

```{r}
df_num <- df[,-c(3,7)]
```


Построим корреляционну матрицу по нашим количественным переменным:

```{r}
cor(df_num)
```
Попарные диаграммы рассеяния будут выглядеть следующим образом:

```{r}
pairs(df_num, col = 'blue')
```

Почти все наши параметры слабо коррелированы так как больше -0.5 и меньше 0.5. Самая большая корреляция 0.4352 между ростом и весом. Самая маленькая между ростом и возрастом -0.00645.


Рассчитаем значение множественного коэффициента корреляции. bwt от остальных переменных:

```{r}
model<-lm(bwt~gestation+smoke+weight+ parity + age + height, data = df)
cor(model$model$bwt, model$fitted.values)

```


Посчитаем частный коэффициент корреляции между bwt и gestation. Вызываем функцию pcor из библиотеки ggm. Первые два аргумента – номера переменных, для которых нужно вычислить коэффициент, а остальные аргументы – номера «влияющих» переменных (воздействие которых должно быть отделено).

```{r}
pcor(c('bwt','gestation','age','height','weight'), var(df_num))
```

Возьмем два произвольных номинальных признака age, height. Проверим гипотезу о независимости двух признаков. Воспользуемся функцией chisq.test для более точного теста Фишера, напишем simulate.p.value = TRUE:

```{r}
chisq.test(table(df$age, df$height),simulate.p.value = TRUE)
assocstats(table(df[,c(4,5)]))
```

Как мы видим p-value > 0.05. На имеющихся данных на уровне значимости 5% нет оснований отвергнуть нулевую гипотезу о том, что признаки независимы.
```{r}
plot(df$age, df$height,xlab = "Возраст", 
     ylab = "Рост", 
     pch = 19, col = 'blue')
```



## Задание 5

Линейная регрессия.

Зависимая переменная: Вес ребенка при рождении.

На первый взгляд кажется, что все предикторы: срок беременности, показатель паритета, возраст матери, рост матери, вес матери, курит ли мать подходят, и не понятно какой из признаков удалить, и стоит ли вообще это делать. Выясним это:


```{r}
model<-lm(bwt~gestation+smoke+weight+ parity + age + height, data = df)
```


Найдем оптимальную модель. Для этого воспользуемся функции step с направлением backward:

```{r}
optimal <- step(model, direction = 'backward')
summary(optimal)
```

Как видно признак age отсутствует. Следовательно, можно убрать этот признак. Улучшим нашу модель выкинув предиктор age:

```{r}
model_optimal<-lm(bwt~gestation+smoke+weight+ parity  + height, data = df)
summod <- summary(model_optimal)
summod
```


Метрика MSE - измеряет среднюю сумму квадратной разности между фактическим значением и прогнозируемым значением для всех точек данных. Найдем MSE для наших данных:

```{r}
MSE <- mean(summod$residuals^2)
```

R^2 - коэффициент детерминации на сколько наша модель лучше, чем константное решение или как достоверность соответствия набора прогнозов фактическим значениям.

```{r}
R2 <- summod$r.squared
```

R2adj - скорректированный R2. Для того, чтобы была возможность сравнивать модели с разным числом признаков.

```{r}
R2adj <-summod$adj.r.squared 
```

В самой первой модели R2adj равнялся 0.2541, и после того, как мы убрали признак age R2adj, стал равным 0.2548, то есть увеличился. Следовательно, мы не зря его убрали.


St.err остаточная стандартная ошибка. В нашей модели она равняется 15.82.


F_statistics используется для оценки значимости модели регрессии в целом, является соотношением объяснимой дисперсии, к необъяснимой. Если модель линейной регрессии построена удачно, то она объясняет значительную часть дисперсии, оставляя в знаменателе малую часть. Чем больше значение параметра — тем лучше.
```{r}
F_statistics <- summod$fstatistic
```


В нашем случае для alpha = 0.05 и 7 признаками t критическое равно 2.365. Если  t value больше по модулю t критического, то признак считается значимым. У нас признаки gestation,  smoke, parity, height являются вполне значимыми, чего нельзя сказать о признаке age.


p_value . В столбце р-значение приводится достоверность отличия соответствующих коэффициентов от нуля. В случае, когда р>0.05, коэффициент может считаться нулевым. Это означает, что соответствующая независимая переменная практически не влияет на зависимую переменную, и коэффициент может быть убран из уравнения. В нашей модели все p_value меньше 0.05. Но признак weight близок к 0.05, и как показала t статистика, этот фактор не сильно значим для нашей модели.



Построим доверительный интервалы для всех параметров:

```{r}
confint(model_optimal)

```

Чем шире доверительный интервал для заданного уровня вероятности (скажем, 95%), тем ниже уровень «доверия» к выборочным оценкам, и наоборот. 









